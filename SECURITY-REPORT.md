# TicketWise Security Assessment Report

**Date:** 2026-02-06 (Updated: 2026-02-07)
**Target:** https://ticketwise.ingeniotech.co.uk
**Assessor:** Stavros (AI Security Review)

---

## Executive Summary

Overall security posture is **GOOD** for an internal tool. The critical postMessage vulnerability has been remediated.

| Severity | Count |
|----------|-------|
| üî¥ Critical | 0 |
| üü† High | 0 ‚úÖ (was 1) |
| üü° Medium | 2 ‚úÖ (was 3) |
| üîµ Low | 4 |
| ‚ÑπÔ∏è Info | 3 |

---

## Findings

### ‚úÖ RESOLVED: PostMessage Origin Validation

**Location:** `src/hooks/use-hosted-api.ts`

**Status:** FIXED (2026-02-07)

Origin validation is now implemented:
```javascript
const ALLOWED_ORIGINS = [
  "https://eu.myconnectwise.net",
  "https://na.myconnectwise.net",
  "https://au.myconnectwise.net",
  "https://staging.connectwisedev.com",
];

// Messages from unknown origins are rejected
if (!ALLOWED_ORIGINS.some(origin => event.origin.startsWith(origin))) {
  return;
}
```

Responses are sent to the verified parent origin, not `"*"`.

---

### ‚úÖ RESOLVED: TLS 1.0/1.1 (Cloudflare)

**Status:** FIXED (2026-02-07)

Minimum TLS version set to 1.2 across all Cloudflare zones.

---

### üü° MEDIUM: Missing Security Headers

**Issue:** Several recommended security headers are not present:

| Header | Status | Recommendation |
|--------|--------|----------------|
| `X-Content-Type-Options` | ‚ùå Missing | Add `nosniff` |
| `X-XSS-Protection` | ‚ùå Missing | Add `1; mode=block` (legacy browsers) |
| `Strict-Transport-Security` | ‚úÖ Fixed | HSTS enabled via Cloudflare |
| `Referrer-Policy` | ‚ùå Missing | Add `strict-origin-when-cross-origin` |
| `Permissions-Policy` | ‚ùå Missing | Restrict unnecessary browser features |

**Note:** `X-Frame-Options` is intentionally omitted to allow iframe embedding.

---

### üü° MEDIUM: Rate Limiting

**Status:** IMPLEMENTED

Rate limiting is now implemented at 30 requests per minute per member.

---

### üîµ LOW: Cookie Security - SameSite=None

**Location:** `src/actions/auth.ts`

**Issue:** Cookies are set with `sameSite: "none"` which is required for cross-site iframe usage.

**Mitigation:** The `httpOnly: true` and `secure: true` flags are correctly set. `SameSite=None` is necessary for the pod to work in the CW iframe.

---

### üîµ LOW: No CSRF Protection

**Issue:** No CSRF tokens implemented.

**Mitigation:** Since this is a pod that only functions within ConnectWise (standalone access is blocked), and cookies require the CW context to be set, the risk is reduced.

---

### üîµ LOW: Technology Stack Disclosure

**Issue:** The 404 page reveals Next.js framework usage.

**Risk:** Minimal - attackers could identify the framework, but this is low-value information.

---

### üîµ LOW: API Key Permissions Too Broad

**Issue:** The ConnectWise API key has read access to more areas than needed.

**Recommendation:** Create a dedicated API member with minimal permissions:
- Service Tickets: Read
- Configurations: Read

---

### ‚ÑπÔ∏è INFO: Standalone Access Blocked (Good!)

The application correctly detects standalone access and blocks usage.

---

### ‚ÑπÔ∏è INFO: No Sensitive Data in JS Bundles

Scanned all JavaScript bundles for API keys, secrets, tokens - none found.

---

### ‚ÑπÔ∏è INFO: Health Endpoint Minimal Disclosure

The `/api/health` endpoint returns minimal, non-sensitive information.

---

## Recommendations Priority

1. ~~**Immediate:** Implement postMessage origin validation~~ ‚úÖ DONE
2. **Short-term:** Add security headers via middleware
3. ~~**Short-term:** Set Cloudflare minimum TLS to 1.2~~ ‚úÖ DONE
4. ~~**Medium-term:** Implement rate limiting~~ ‚úÖ DONE
5. **Medium-term:** Create restricted CW API member
6. **Nice-to-have:** Add CSRF tokens

---

## Cloudflare Security (Updated 2026-02-07)

The following Cloudflare settings have been applied to ingeniotech.co.uk:

- ‚úÖ Minimum TLS 1.2
- ‚úÖ HSTS enabled (6 months, includeSubDomains)
- ‚úÖ Always Use HTTPS
- ‚úÖ SSL Mode: Full
- ‚úÖ Bot Fight Mode (pending - dashboard only)
- ‚è≥ DNSSEC (pending - requires registrar update)

---

*Report generated by automated security assessment*
*Last updated: 2026-02-07 by Stavros*
